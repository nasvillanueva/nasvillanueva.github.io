{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/dev/monitor-hotplug","result":{"data":{"site":{"siteMetadata":{"title":"nandemonas","author":"Nas Villanueva"}},"post":{"id":"367e5ec4-3107-5890-a64d-87f6e21a3261","html":"<p>I finally managed to write a <code class=\"language-text\">udev</code> rule that executes my <code class=\"language-text\">xrandr</code> script\nwhen plugging an external monitor for my work laptop. I’ve tried to write\nthis script so many times before, but failed to make it work. I’m not sure\nif it’s because my setup at the time supported it very well, or if I\njust wasn’t motivated enough to make it work.</p>\n<!--excerpt-->\n<p>After listening to the <a href=\"https://nixers.net\">Nixers</a> <a href=\"https://podcast.nixers.net/feed\">Podcast</a>, for\nsome unknown reason, I was motivated to write one that actually works.</p>\n<p>Here’s my <code class=\"language-text\">/etc/udev/rules.d/99-monitor-hotplug.rules</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token assign-left variable\">KERNEL</span><span class=\"token operator\">==</span><span class=\"token string\">\"card0\"</span>, <span class=\"token assign-left variable\">SUBSYSTEM</span><span class=\"token operator\">==</span><span class=\"token string\">\"drm\"</span>, ENV<span class=\"token punctuation\">{</span><span class=\"token environment constant\">DISPLAY</span><span class=\"token punctuation\">}</span><span class=\"token operator\">=</span><span class=\"token string\">\":0\"</span>, ENV<span class=\"token punctuation\">{</span><span class=\"token environment constant\">XAUTHORITY</span><span class=\"token punctuation\">}</span><span class=\"token operator\">=</span><span class=\"token string\">\"/home/jvillanueva/.Xauthority\"</span>, <span class=\"token assign-left variable\">RUN</span><span class=\"token operator\">+=</span><span class=\"token string\">\"/home/jvillanueva/.bin/hotplug.sh\"</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>and here’s my <code class=\"language-text\">hotplug.sh</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">DISPLAY</span></span><span class=\"token operator\">=</span>:0\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">XAUTHORITY</span></span><span class=\"token operator\">=</span>/home/jvillanueva/.Xauthority\n<span class=\"token assign-left variable\">MONITOR</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>xrandr <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">\" connected\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$MONITOR</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    xrandr <span class=\"token parameter variable\">--output</span> eDP1 <span class=\"token parameter variable\">--auto</span>\n<span class=\"token keyword\">else</span>\n    xrandr <span class=\"token parameter variable\">--output</span> eDP1 <span class=\"token parameter variable\">--auto</span> <span class=\"token parameter variable\">--output</span> HDMI1 --right-of eDP1 <span class=\"token parameter variable\">--auto</span>\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token function\">sleep</span> <span class=\"token number\">5</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">sh</span> /home/jvillanueva/.bin/wall-e <span class=\"token operator\">&amp;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>After putting everything in place, I reloaded <code class=\"language-text\">udev</code> rules and services\nvia:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\">udevadm control --reload-rules\nsystemctl restart systemd-udevd</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>Then I tried connecting my external monitor and boom, <code class=\"language-text\">udev</code> executed <code class=\"language-text\">hotplug.sh</code>.\nNow, all of my monitors are automatically configured everytime I [un]plug my external\nmonitor. My script also calls another script that [re]sets my wallpaper\nusing <a href=\"https://github.com/nasvillanueva/hsetroot\"><code class=\"language-text\">hsetroot</code></a>.</p>\n<p>Here’s my <code class=\"language-text\">wall-e</code> script:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-bash line-numbers\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n\n<span class=\"token builtin class-name\">.</span> /home/jvillanueva/.zshenv\n<span class=\"token assign-left variable\">WALL</span><span class=\"token operator\">=</span><span class=\"token variable\">$WALLPAPER_PATH</span>\n<span class=\"token assign-left variable\">GRAY_TINT</span><span class=\"token operator\">=</span><span class=\"token string\">'#c7c7c7'</span>\n<span class=\"token assign-left variable\">RED_TINT</span><span class=\"token operator\">=</span><span class=\"token string\">'#947575'</span>\nhsetroot <span class=\"token parameter variable\">-screens</span> <span class=\"token number\">3</span> <span class=\"token parameter variable\">-fill</span> <span class=\"token variable\">$WALL</span> <span class=\"token parameter variable\">-tint</span> <span class=\"token variable\">$RED_TINT</span> <span class=\"token operator\">&amp;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>","frontmatter":{"title":"Monitor Hotplug for Linux","date":"2017-06-12","tags":["Scripts","Bash","Shell"]}},"relatedPosts":{"nodes":[{"frontmatter":{"tags":["Scripts","Docker","Shell","DevOps"],"date":"2017-08-11","title":"Migrating Docker Images"},"fields":{"readingTime":{"text":"3 min read"},"site":"dev","slug":"/dev/migrating-docker-images"}},{"frontmatter":{"tags":["Scripts","Bash","Shell"],"date":"2017-06-12","title":"Monitor Hotplug for Linux"},"fields":{"readingTime":{"text":"2 min read"},"site":"dev","slug":"/dev/monitor-hotplug"}},{"frontmatter":{"tags":["Scripts","Powershell","DevOps"],"date":"2019-03-15","title":"reset_edge.ps1 — Prevent Karma tests from breaking Microsoft Edge"},"fields":{"readingTime":{"text":"3 min read"},"site":"dev","slug":"/dev/reset-edge"}}]}},"pageContext":{"slug":"/dev/monitor-hotplug","tags":["Scripts","Bash","Shell"]}},"staticQueryHashes":[]}