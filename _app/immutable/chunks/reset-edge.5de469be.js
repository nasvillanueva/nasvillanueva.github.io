import{S as oa,i as na,s as la,k as o,q as r,a as u,l as n,m as l,r as p,h as a,c as h,n as c,b as i,G as t,K as _t}from"./index.06f43c05.js";function ra(Yt){let f,ye,X,Ie,Ae,v,Pe,Me,E,xe,Te,g,Se,Le,J,Re,$e,ne,j,je,le,d,F,y,Fe,Ce,Ne,C,I,Oe,We,De,N,A,Ge,Ke,Ue,O,P,He,Be,qe,Z,Ve,re,W,Xe,pe,M,D,Je,ie,G,K,z,Ze,ze,ce,b,Qe,Q,Ye,et,ue,x,ea=`<code class="language-powershell"><span class="token variable">$wshell</span> = <span class="token function">New-Object</span> <span class="token operator">-</span>ComObject wscript<span class="token punctuation">.</span>shell<span class="token punctuation">;</span>
<span class="token variable">$wshell</span><span class="token punctuation">.</span>AppActivate<span class="token punctuation">(</span><span class="token string">'Microsoft Edge'</span><span class="token punctuation">)</span> <span class="token punctuation">|</span> <span class="token function">out-null</span><span class="token punctuation">;</span>
<span class="token function">Sleep</span> 1<span class="token punctuation">;</span>
<span class="token variable">$wshell</span><span class="token punctuation">.</span>SendKeys<span class="token punctuation">(</span><span class="token string">"%&#123;f4&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>`,he,k,tt,Y,at,st,ee,ot,nt,fe,T,U,lt,de,_,rt,te,pt,it,ke,S,ta=`<code class="language-powershell"><span class="token variable">$MicrosoftEdgePath</span> = <span class="token function">Join-Path</span> <span class="token variable">$ENV</span>:APPDATA <span class="token string">"..LocalPackagesMicrosoft.MicrosoftEdge_8wekyb3d8bbwe"</span> <span class="token operator">-</span>Resolve <span class="token operator">-</span>ErrorAction SilentlyContinue
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$MicrosoftEdgePath</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment"># Take Ownership of Edge's data folder</span>
    takeown <span class="token operator">/</span>F <span class="token variable">$MicrosoftEdgePath</span><span class="token operator">*</span> <span class="token operator">/</span>R <span class="token operator">/</span>A
    icacls <span class="token variable">$MicrosoftEdgePath</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token operator">/</span>T <span class="token operator">/</span>grant administrators:F
    <span class="token comment"># Delete Edge's data folder starting from the inner most file</span>
    <span class="token function">Get-ChildItem</span> <span class="token operator">-</span>Path <span class="token variable">$MicrosoftEdgePath</span> <span class="token operator">-</span>Force <span class="token operator">-</span>Recurse <span class="token punctuation">|</span>
            <span class="token function">Sort-Object</span> <span class="token operator">-</span>Property FullName <span class="token operator">-</span>Descending <span class="token punctuation">|</span>
            <span class="token function">Remove-Item</span> <span class="token operator">-</span>Recurse <span class="token operator">-</span>Force
    <span class="token function">rm</span> <span class="token variable">$MicrosoftEdgePath</span>
<span class="token punctuation">&#125;</span>
<span class="token comment"># Re-setup Edge</span>
<span class="token function">Get-AppXPackage</span> <span class="token operator">-</span>AllUsers <span class="token operator">-</span>Name Microsoft<span class="token punctuation">.</span>MicrosoftEdge <span class="token punctuation">|</span>
        <span class="token keyword">Foreach</span> <span class="token punctuation">&#123;</span>
            <span class="token function">Add-AppxPackage</span> <span class="token operator">-</span>DisableDevelopmentMode <span class="token operator">-</span>Register <span class="token string">"<span class="token function">$<span class="token punctuation">(</span> <span class="token variable">$_</span><span class="token punctuation">.</span>InstallLocation <span class="token punctuation">)</span></span>AppXManifest.xml"</span> <span class="token operator">-</span>Verbose
        <span class="token punctuation">&#125;</span></code>`,me,H,ct,we,ve,Ee,B,ut,ge,m,ae,L,ht,ft,se,R,dt,kt,oe,$,mt;return{c(){f=o("p"),ye=r("Like almost everybody else, we "),X=o("em"),Ie=r("need to"),Ae=r(" test our app in Microsoft Edge, and since we are using "),v=o("a"),Pe=r("Angular.js"),Me=r(`
it seems that `),E=o("a"),xe=r("Karma"),Te=r(" + "),g=o("a"),Se=r("karma-edge-launcher"),Le=r(` are the best tools to
do that. The problem is, karma-edge-launcher‚Äôs latest version, 0.8.2 at the time of writing, doesn‚Äôt `),J=o("em"),Re=r("gracefully"),$e=r(` shuts down Edge which makes it restore
all tabs upon next launch. That‚Äôs why consecutive CI builds floods Edge with tabs until it stops launching and the only way to fix it is to restart the build server.`),ne=u(),j=o("p"),je=r("Before heading to the solution, I‚Äôd like to list down some Github Tickets related to this issue:"),le=u(),d=o("ul"),F=o("li"),y=o("a"),Fe=r("edge-launcher#23"),Ce=r(": Edge opens with wrong address"),Ne=u(),C=o("li"),I=o("a"),Oe=r("karma-edge-launcher#1"),We=r(": Error launching Edge on Windows 10 in CI environment (karma, jenkins)"),De=u(),N=o("li"),A=o("a"),Ge=r("karma-edge-launcher#4"),Ke=r(": Edge does not close its tabs"),Ue=u(),O=o("li"),P=o("a"),He=r("karma-edge-launcher#33"),Be=r(": remove /f flag from kill command and call it twice so edge exits cleanly"),qe=u(),Z=o("li"),Ve=r("and more‚Ä¶"),re=u(),W=o("p"),Xe=r(`There‚Äôs a lot of tickets being related to each other that‚Äôs related to this issue, and even though some of them are already close, no one seems to be able to fix it
or they just gave up.`),pe=u(),M=o("h2"),D=o("a"),Je=r("Initial Solution"),ie=u(),G=o("p"),K=o("em"),z=o("strong"),Ze=r("Spoiler Alert"),ze=r(": It didn‚Äôt fix the issue."),ce=u(),b=o("p"),Qe=r("I asked a coworker who is knowledgeable about Windows and he gave me this powershell script that sends "),Q=o("code"),Ye=r("Alt+F4"),et=r(" to Edge:"),ue=u(),x=o("pre"),he=u(),k=o("p"),tt=r("This script works "),Y=o("strong"),at=r("IF"),st=r(` Edge still runs when it is executed. Unfortunately, the problem was Edge can‚Äôt launch anymore and karma-edge-launcher makes sure that
it is `),ee=o("em"),ot=r("ungracefully"),nt=r(" killed."),fe=u(),T=o("h2"),U=o("a"),lt=r("Actual Solution"),de=u(),_=o("p"),rt=r(`While trying too look for a solution, I saw articles about Edge being broken and how to fix it by resetting it to a fresh state.
So I thought `),te=o("em"),pt=r("‚ÄúWhat if we can use the same method before each test to clear all restored tabs‚Äù"),it=r(`, then I‚Äôve come up with this powershell script
based on what I‚Äôve read.`),ke=u(),S=o("pre"),me=u(),H=o("p"),ct=r("Now, we don‚Äôt need to restart the server manually every time Karma breaks Edge. üòé"),we=u(),ve=o("br"),Ee=u(),B=o("p"),ut=r("References:"),ge=u(),m=o("ul"),ae=o("li"),L=o("a"),ht=r("https://stackoverflow.com/a/34636812"),ft=u(),se=o("li"),R=o("a"),dt=r("https://www.groovypost.com/howto/reset-microsoft-edge-default-settings/"),kt=u(),oe=o("li"),$=o("a"),mt=r("https://www.apeswithcomputers.com/article/take-ownership-with-the-command-prompt-powershell"),this.h()},l(e){f=n(e,"P",{});var s=l(f);ye=p(s,"Like almost everybody else, we "),X=n(s,"EM",{});var yt=l(X);Ie=p(yt,"need to"),yt.forEach(a),Ae=p(s," test our app in Microsoft Edge, and since we are using "),v=n(s,"A",{href:!0,target:!0,rel:!0});var It=l(v);Pe=p(It,"Angular.js"),It.forEach(a),Me=p(s,`
it seems that `),E=n(s,"A",{href:!0,target:!0,rel:!0});var At=l(E);xe=p(At,"Karma"),At.forEach(a),Te=p(s," + "),g=n(s,"A",{href:!0,target:!0,rel:!0});var Pt=l(g);Se=p(Pt,"karma-edge-launcher"),Pt.forEach(a),Le=p(s,` are the best tools to
do that. The problem is, karma-edge-launcher‚Äôs latest version, 0.8.2 at the time of writing, doesn‚Äôt `),J=n(s,"EM",{});var Mt=l(J);Re=p(Mt,"gracefully"),Mt.forEach(a),$e=p(s,` shuts down Edge which makes it restore
all tabs upon next launch. That‚Äôs why consecutive CI builds floods Edge with tabs until it stops launching and the only way to fix it is to restart the build server.`),s.forEach(a),ne=h(e),j=n(e,"P",{});var xt=l(j);je=p(xt,"Before heading to the solution, I‚Äôd like to list down some Github Tickets related to this issue:"),xt.forEach(a),le=h(e),d=n(e,"UL",{});var w=l(d);F=n(w,"LI",{});var wt=l(F);y=n(wt,"A",{href:!0,rel:!0});var Tt=l(y);Fe=p(Tt,"edge-launcher#23"),Tt.forEach(a),Ce=p(wt,": Edge opens with wrong address"),wt.forEach(a),Ne=h(w),C=n(w,"LI",{});var vt=l(C);I=n(vt,"A",{href:!0,rel:!0});var St=l(I);Oe=p(St,"karma-edge-launcher#1"),St.forEach(a),We=p(vt,": Error launching Edge on Windows 10 in CI environment (karma, jenkins)"),vt.forEach(a),De=h(w),N=n(w,"LI",{});var Et=l(N);A=n(Et,"A",{href:!0,rel:!0});var Lt=l(A);Ge=p(Lt,"karma-edge-launcher#4"),Lt.forEach(a),Ke=p(Et,": Edge does not close its tabs"),Et.forEach(a),Ue=h(w),O=n(w,"LI",{});var gt=l(O);P=n(gt,"A",{href:!0,rel:!0});var Rt=l(P);He=p(Rt,"karma-edge-launcher#33"),Rt.forEach(a),Be=p(gt,": remove /f flag from kill command and call it twice so edge exits cleanly"),gt.forEach(a),qe=h(w),Z=n(w,"LI",{});var $t=l(Z);Ve=p($t,"and more‚Ä¶"),$t.forEach(a),w.forEach(a),re=h(e),W=n(e,"P",{});var jt=l(W);Xe=p(jt,`There‚Äôs a lot of tickets being related to each other that‚Äôs related to this issue, and even though some of them are already close, no one seems to be able to fix it
or they just gave up.`),jt.forEach(a),pe=h(e),M=n(e,"H2",{id:!0});var Ft=l(M);D=n(Ft,"A",{href:!0});var Ct=l(D);Je=p(Ct,"Initial Solution"),Ct.forEach(a),Ft.forEach(a),ie=h(e),G=n(e,"P",{});var Nt=l(G);K=n(Nt,"EM",{});var bt=l(K);z=n(bt,"STRONG",{});var Ot=l(z);Ze=p(Ot,"Spoiler Alert"),Ot.forEach(a),ze=p(bt,": It didn‚Äôt fix the issue."),bt.forEach(a),Nt.forEach(a),ce=h(e),b=n(e,"P",{});var be=l(b);Qe=p(be,"I asked a coworker who is knowledgeable about Windows and he gave me this powershell script that sends "),Q=n(be,"CODE",{});var Wt=l(Q);Ye=p(Wt,"Alt+F4"),Wt.forEach(a),et=p(be," to Edge:"),be.forEach(a),ue=h(e),x=n(e,"PRE",{class:!0});var aa=l(x);aa.forEach(a),he=h(e),k=n(e,"P",{});var q=l(k);tt=p(q,"This script works "),Y=n(q,"STRONG",{});var Dt=l(Y);at=p(Dt,"IF"),Dt.forEach(a),st=p(q,` Edge still runs when it is executed. Unfortunately, the problem was Edge can‚Äôt launch anymore and karma-edge-launcher makes sure that
it is `),ee=n(q,"EM",{});var Gt=l(ee);ot=p(Gt,"ungracefully"),Gt.forEach(a),nt=p(q," killed."),q.forEach(a),fe=h(e),T=n(e,"H2",{id:!0});var Kt=l(T);U=n(Kt,"A",{href:!0});var Ut=l(U);lt=p(Ut,"Actual Solution"),Ut.forEach(a),Kt.forEach(a),de=h(e),_=n(e,"P",{});var _e=l(_);rt=p(_e,`While trying too look for a solution, I saw articles about Edge being broken and how to fix it by resetting it to a fresh state.
So I thought `),te=n(_e,"EM",{});var Ht=l(te);pt=p(Ht,"‚ÄúWhat if we can use the same method before each test to clear all restored tabs‚Äù"),Ht.forEach(a),it=p(_e,`, then I‚Äôve come up with this powershell script
based on what I‚Äôve read.`),_e.forEach(a),ke=h(e),S=n(e,"PRE",{class:!0});var sa=l(S);sa.forEach(a),me=h(e),H=n(e,"P",{});var Bt=l(H);ct=p(Bt,"Now, we don‚Äôt need to restart the server manually every time Karma breaks Edge. üòé"),Bt.forEach(a),we=h(e),ve=n(e,"BR",{}),Ee=h(e),B=n(e,"P",{});var qt=l(B);ut=p(qt,"References:"),qt.forEach(a),ge=h(e),m=n(e,"UL",{});var V=l(m);ae=n(V,"LI",{});var Vt=l(ae);L=n(Vt,"A",{href:!0,rel:!0});var Xt=l(L);ht=p(Xt,"https://stackoverflow.com/a/34636812"),Xt.forEach(a),Vt.forEach(a),ft=h(V),se=n(V,"LI",{});var Jt=l(se);R=n(Jt,"A",{href:!0,rel:!0});var Zt=l(R);dt=p(Zt,"https://www.groovypost.com/howto/reset-microsoft-edge-default-settings/"),Zt.forEach(a),Jt.forEach(a),kt=h(V),oe=n(V,"LI",{});var zt=l(oe);$=n(zt,"A",{href:!0,rel:!0});var Qt=l($);mt=p(Qt,"https://www.apeswithcomputers.com/article/take-ownership-with-the-command-prompt-powershell"),Qt.forEach(a),zt.forEach(a),V.forEach(a),this.h()},h(){c(v,"href","https://angularjs.org/"),c(v,"target","_blank"),c(v,"rel","noreferrer"),c(E,"href","https://karma-runner.github.io/"),c(E,"target","_blank"),c(E,"rel","noreferrer"),c(g,"href","https://www.npmjs.com/package/karma-edge-launcher"),c(g,"target","_blank"),c(g,"rel","noreferrer"),c(y,"href","https://github.com/MicrosoftEdge/edge-launcher/issues/23"),c(y,"rel","nofollow"),c(I,"href","https://github.com/karma-runner/karma-edge-launcher/issues/1"),c(I,"rel","nofollow"),c(A,"href","https://github.com/karma-runner/karma-edge-launcher/issues/4"),c(A,"rel","nofollow"),c(P,"href","https://github.com/nickmccurdy/karma-edge-launcher/pull/33"),c(P,"rel","nofollow"),c(D,"href","#initial-solution"),c(M,"id","initial-solution"),c(x,"class","language-powershell"),c(U,"href","#actual-solution"),c(T,"id","actual-solution"),c(S,"class","language-powershell"),c(L,"href","https://stackoverflow.com/a/34636812"),c(L,"rel","nofollow"),c(R,"href","https://www.groovypost.com/howto/reset-microsoft-edge-default-settings/"),c(R,"rel","nofollow"),c($,"href","https://www.apeswithcomputers.com/article/take-ownership-with-the-command-prompt-powershell"),c($,"rel","nofollow")},m(e,s){i(e,f,s),t(f,ye),t(f,X),t(X,Ie),t(f,Ae),t(f,v),t(v,Pe),t(f,Me),t(f,E),t(E,xe),t(f,Te),t(f,g),t(g,Se),t(f,Le),t(f,J),t(J,Re),t(f,$e),i(e,ne,s),i(e,j,s),t(j,je),i(e,le,s),i(e,d,s),t(d,F),t(F,y),t(y,Fe),t(F,Ce),t(d,Ne),t(d,C),t(C,I),t(I,Oe),t(C,We),t(d,De),t(d,N),t(N,A),t(A,Ge),t(N,Ke),t(d,Ue),t(d,O),t(O,P),t(P,He),t(O,Be),t(d,qe),t(d,Z),t(Z,Ve),i(e,re,s),i(e,W,s),t(W,Xe),i(e,pe,s),i(e,M,s),t(M,D),t(D,Je),i(e,ie,s),i(e,G,s),t(G,K),t(K,z),t(z,Ze),t(K,ze),i(e,ce,s),i(e,b,s),t(b,Qe),t(b,Q),t(Q,Ye),t(b,et),i(e,ue,s),i(e,x,s),x.innerHTML=ea,i(e,he,s),i(e,k,s),t(k,tt),t(k,Y),t(Y,at),t(k,st),t(k,ee),t(ee,ot),t(k,nt),i(e,fe,s),i(e,T,s),t(T,U),t(U,lt),i(e,de,s),i(e,_,s),t(_,rt),t(_,te),t(te,pt),t(_,it),i(e,ke,s),i(e,S,s),S.innerHTML=ta,i(e,me,s),i(e,H,s),t(H,ct),i(e,we,s),i(e,ve,s),i(e,Ee,s),i(e,B,s),t(B,ut),i(e,ge,s),i(e,m,s),t(m,ae),t(ae,L),t(L,ht),t(m,ft),t(m,se),t(se,R),t(R,dt),t(m,kt),t(m,oe),t(oe,$),t($,mt)},p:_t,i:_t,o:_t,d(e){e&&a(f),e&&a(ne),e&&a(j),e&&a(le),e&&a(d),e&&a(re),e&&a(W),e&&a(pe),e&&a(M),e&&a(ie),e&&a(G),e&&a(ce),e&&a(b),e&&a(ue),e&&a(x),e&&a(he),e&&a(k),e&&a(fe),e&&a(T),e&&a(de),e&&a(_),e&&a(ke),e&&a(S),e&&a(me),e&&a(H),e&&a(we),e&&a(ve),e&&a(Ee),e&&a(B),e&&a(ge),e&&a(m)}}}const ia={title:"reset_edge.ps1 ‚Äî Prevent Karma tests from breaking Microsoft Edge",date:"2019-03-15T14:56:50.244Z",tags:["Scripts","Powershell","DevOps"]};class ca extends oa{constructor(f){super(),na(this,f,null,ra,la,{})}}export{ca as default,ia as metadata};
