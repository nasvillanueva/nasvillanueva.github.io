{"data":{"site":{"siteMetadata":{"title":"nandemonas","author":"Nas Villanueva"}},"markdownRemark":{"id":"4e2f69a1-eaa3-5b68-9fb1-f39d35347f20","excerpt":"\nI finally managed to write a `udev` rule that executes my `xrandr` script\nwhen plugging an external monitor for my work laptop. I've tried to write\nthis script so many times before, but failed to make it work. I'm not sure\nif it's because my setup at the time supported it very well, or if I\njust wasn't motivated enough to make it work.\n\n","html":"<p>I finally managed to write a <code class=\"language-text\">udev</code> rule that executes my <code class=\"language-text\">xrandr</code> script\nwhen plugging an external monitor for my work laptop. I’ve tried to write\nthis script so many times before, but failed to make it work. I’m not sure\nif it’s because my setup at the time supported it very well, or if I\njust wasn’t motivated enough to make it work.</p>\n<!--excerpt-->\n<p>After listening to the <a href=\"https://nixers.net\">Nixers</a> <a href=\"https://podcast.nixers.net/feed\">Podcast</a>, for\nsome unknown reason, I was motivated to write one that actually works.</p>\n<p>Here’s my <code class=\"language-text\">/etc/udev/rules.d/99-monitor-hotplug.rules</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">KERNEL<span class=\"token operator\">==</span><span class=\"token string\">\"card0\"</span>, SUBSYSTEM<span class=\"token operator\">==</span><span class=\"token string\">\"drm\"</span>, ENV<span class=\"token punctuation\">{</span>DISPLAY<span class=\"token punctuation\">}</span><span class=\"token operator\">=</span><span class=\"token string\">\":0\"</span>, ENV<span class=\"token punctuation\">{</span>XAUTHORITY<span class=\"token punctuation\">}</span><span class=\"token operator\">=</span><span class=\"token string\">\"/home/jvillanueva/.Xauthority\"</span>, RUN+<span class=\"token operator\">=</span><span class=\"token string\">\"/home/jvillanueva/.bin/hotplug.sh\"</span></code></pre></div>\n<p>and here’s my <code class=\"language-text\">hotplug.sh</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n<span class=\"token function\">export</span> DISPLAY<span class=\"token operator\">=</span>:0\n<span class=\"token function\">export</span> XAUTHORITY<span class=\"token operator\">=</span>/home/jvillanueva/.Xauthority\nMONITOR<span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span>xrandr <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">\" connected\"</span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> -l<span class=\"token variable\">)</span></span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$MONITOR</span> -eq 1 <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\n    xrandr --output eDP1 --auto\n<span class=\"token keyword\">else</span>\n    xrandr --output eDP1 --auto --output HDMI1 --right-of eDP1 --auto\n<span class=\"token keyword\">fi</span>\n\n<span class=\"token function\">sleep</span> 5 <span class=\"token operator\">&amp;&amp;</span> sh /home/jvillanueva/.bin/wall-e <span class=\"token operator\">&amp;</span></code></pre></div>\n<p>After putting everything in place, I reloaded <code class=\"language-text\">udev</code> rules and services\nvia:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">udevadm control --reload-rules\nsystemctl restart systemd-udevd</code></pre></div>\n<p>Then I tried connecting my external monitor and boom, <code class=\"language-text\">udev</code> executed <code class=\"language-text\">hotplug.sh</code>.\nNow, all of my monitors are automatically configured everytime I [un]plug my external\nmonitor. My script also calls another script that [re]sets my wallpaper\nusing <a href=\"https://github.com/nasvillanueva/hsetroot\"><code class=\"language-text\">hsetroot</code></a>.</p>\n<p>Here’s my <code class=\"language-text\">wall-e</code> script:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/sh</span>\n\n<span class=\"token keyword\">.</span> /home/jvillanueva/.zshenv\nWALL<span class=\"token operator\">=</span><span class=\"token variable\">$WALLPAPER_PATH</span>\nGRAY_TINT<span class=\"token operator\">=</span><span class=\"token string\">'#c7c7c7'</span>\nRED_TINT<span class=\"token operator\">=</span><span class=\"token string\">'#947575'</span>\nhsetroot -screens 3 -fill <span class=\"token variable\">$WALL</span> -tint <span class=\"token variable\">$RED_TINT</span> <span class=\"token operator\">&amp;</span></code></pre></div>","frontmatter":{"title":"Monitor Hotplug for Linux","date":"June 12, 2017","qiitaUrl":""}}},"pageContext":{"slug":"/20170612-monitor-hotplug/","previous":null,"next":{"fields":{"slug":"/20170811-migrating-docker-images/"},"frontmatter":{"title":"Migrating Docker Images"}}}}