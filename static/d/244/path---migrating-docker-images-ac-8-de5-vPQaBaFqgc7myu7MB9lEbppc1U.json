{"data":{"site":{"siteMetadata":{"title":"nandemonas","author":"Nas Villanueva"}},"markdownRemark":{"id":"f5635296-bbf9-5fd9-b278-10ff0307cc88","excerpt":"\nDo you run your own Docker Registry server? Ever got tired of tagging\nall your images with the registry URL and pushing them one by one? Well,\nwe do and it is very exhausting when you keep doing it again and again. So\nI came up with this script.\n\n","html":"<p>Do you run your own Docker Registry server? Ever got tired of tagging\nall your images with the registry URL and pushing them one by one? Well,\nwe do and it is very exhausting when you keep doing it again and again. So\nI came up with this script.</p>\n<!--excerpt-->\n<blockquote>\n<p>Disclaimer: I was at a different company when I created this post.</p>\n</blockquote>\n<h3>Context</h3>\n<p>We’re developing an enterprise software for a client with a microservices\narchitecture that utilizes <a href=\"https://www.docker.com/\">Docker</a> containers and <a href=\"https://dcos.io/\">DC/OS</a>\norchestration.</p>\n<h3>Our Setup</h3>\n<ul>\n<li>Dozens of microservices built with <a href=\"https://spring.io/\">Spring Framework</a></li>\n<li>Microservices runs on <a href=\"https://dcos.io/\">DC/OS</a>.</li>\n<li>Few environments (development, staging, production) each having their\nown registry.</li>\n</ul>\n<p>Some of the things you might ask me:</p>\n<ul>\n<li>\n<p><strong><em>“Why the f*** do you have more than one registry?”</em></strong>\nProduction was intended to have its own registry since it doesn’t have\nany access to the internet.</p>\n</li>\n<li>\n<p><strong><em>“Why not use a third party private docker registry?”</em></strong>\nProduction servers doesn’t have any internet access (most of the app\nis meant to be access via VPN)</p>\n</li>\n<li>\n<p><strong><em>“Why not use <a href=\"https://jenkins.io/\">Jenkins</a> or some other in-premise CI/CD that\ncan automatically tag and push your images to your different\nenvirnments?”</em></strong>\nActually, I’m not so sure because I’ve heard other companies use CI/CD\nfrom development -> production. Maybe the client doesn’t want CI/CD in\nthe production environment. I really don’t have any idea regarding this.</p>\n</li>\n</ul>\n<h3>Problem</h3>\n<p>It is a pain in the arse when you need to manually tag and push all your\nimages from one registry to another, whether it may come from your local\nmachine or one of your registry servers.</p>\n<h3>Solution</h3>\n<p>I’ve written a <a href=\"https://github.com/nasvillanueva/scripts/blob/master/transfer_images.sh\"><code class=\"language-text\">transfer_images.sh</code></a> found on my\n<a href=\"https://github.com/nasvillanueva/scripts\">scripts repo</a>.</p>\n<p>Usage:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"> ./transfer_images.sh <span class=\"token punctuation\">[</span>-s source<span class=\"token punctuation\">]</span> -d destination -m matcher<span class=\"token punctuation\">[</span>,matcher2,matcher3<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>-p<span class=\"token punctuation\">]</span>\n where:\n    -h print usage\n    -s <span class=\"token function\">source</span> registry <span class=\"token punctuation\">(</span>optional<span class=\"token punctuation\">)</span>\n        example: registry.hub.docker.com\n    -d destination registry <span class=\"token punctuation\">(</span>required<span class=\"token punctuation\">)</span>\n        example: registry.mydomain.com\n    -m matchers <span class=\"token punctuation\">(</span>required<span class=\"token punctuation\">)</span>\n        all the images that will be tagged with the destination\n        example nodejs,jenkins,chronos\n    -p push images <span class=\"token punctuation\">(</span>optional<span class=\"token punctuation\">)</span>\n        push all tagged images</code></pre></div>\n<h3>Examples</h3>\n<p>Given these docker images in your local repositories:</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"> REPOSITORIES               TAG\n node                       8\n rabbitmq                   3.6.9\n postgres                   9.6.1\n yourregistry.com/node      8\n yourregistry.com/rabbitmq  3.6.9\n yourregistry.com/postgres  9.6.1</code></pre></div>\n<p>Tag <code class=\"language-text\">node</code> and <code class=\"language-text\">postgres</code> to <code class=\"language-text\">yourregistry.com</code></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"> ./transfer_images.sh -d yourregistry.com -m node,postgres</code></pre></div>\n<p>Tag <code class=\"language-text\">node</code> and <code class=\"language-text\">rabbitmq</code> tagged with <code class=\"language-text\">yourregistry.com</code> to <code class=\"language-text\">yourotherregistry.com</code> and then push it</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"> ./transfer_images.sh -s yourregistry.com -d yourotherregistry.com -m node,rabbitmq -p</code></pre></div>\n<h3>Wrapping this up</h3>\n<p>So there you have it, my fancy transfer images script. I hope it will help\nsome of you guys/gals that face the same problem as I did. I’ll write\nmore scripts if I encounter more repetitive and/or tedious tasks.</p>","frontmatter":{"title":"Migrating Docker Images","date":"August 11, 2017","qiitaUrl":""}}},"pageContext":{"slug":"/migrating-docker-images/","previous":{"fields":{"slug":"/monitor-hotplug/"},"frontmatter":{"title":"Monitor Hotplug for Linux"}},"next":{"fields":{"slug":"/gifify/"},"frontmatter":{"title":"gifify.sh — Convert Videos to GIFs"}}}}